
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>點餐系統</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.0/firebase-database-compat.js"></script>
  <script src="script.js"></script>
</head>
<body>
  <div class="top-bar">
    <button onclick="switchMode('edit')">編輯模式</button>
    <button onclick="showMenuSelector()">選擇菜單</button>
  </div>

  <div id="menuSelector" style="display:none; text-align:center; margin-top:20px;">
    <label for="menuPicker">請選擇菜單：</label>
    <select id="menuPicker" onchange="loadAndStartOrder()">
      <option disabled selected>載入中...</option>
    </select>
  </div>

  <div id="order-mode" class="section">
    <div id="category-buttons"></div>
    <div id="menu"></div>
    <div class="order-list">
      <h2>🧾 訂單明細</h2>
      <ul id="orderList"></ul>
      <p id="totalPrice">總金額：$0</p>
      <button class="button" onclick="submitOrder()">✅ 送出訂單</button>
    </div>
  </div>

  <div id="edit-mode" class="section" style="display:none;">
    <h2>📋 編輯分類</h2>
    <input type="text" id="newCategory" placeholder="分類名稱" />
    <input type="color" id="categoryColor" value="#ffcc00" />
    <button onclick="addCategory()">新增分類</button>
    <ul id="categoryList"></ul>

    <h2>🍽️ 編輯餐點</h2>
    <input type="text" id="itemName" placeholder="餐點名稱" />
    <select id="itemCategory"></select>
    <input type="number" id="itemPrice" placeholder="一般價格" />
    <input type="number" id="itemLargePrice" placeholder="大份價格" />
    <button onclick="addItem()">新增餐點</button>
    <ul id="menuList"></ul>

    <h2>☁️ 菜單儲存/載入</h2>
    <input type="text" id="menuName" placeholder="菜單名稱" />
    <button onclick="saveMenu()">儲存菜單</button>
    <select id="savedMenus" onchange="loadMenu(this.value)">
      <option value="">--選擇已儲存菜單--</option>
    </select>
    <button onclick="deleteMenu()">刪除菜單</button>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBY2JkCQErm8pyh2B1uCZmeuDohi8DNces",
      authDomain: "order-game-3a2c3.firebaseapp.com",
      databaseURL: "https://order-game-3a2c3-default-rtdb.firebaseio.com",
      projectId: "order-game-3a2c3",
      storageBucket: "order-game-3a2c3.appspot.com",
      messagingSenderId: "793590994015",
      appId: "1:793590994015:web:d089bf8bea249a3837f7ea"
    };
    
    window.onload = () => {
      // 自動初始化下拉清單（非立即顯示）
      const picker = document.getElementById("menuPicker");
      firebase.database().ref("menus").once("value", snapshot => {
        picker.innerHTML = "";
        snapshot.forEach(child => {
          const opt = document.createElement("option");
          opt.value = child.key;
          opt.textContent = child.key;
          picker.appendChild(opt);
        });
      });
    };

    function showMenuSelector() {
      document.getElementById("menuSelector").style.display = "block";
    }

      document.getElementById("menuSelector").style.display = "block";
      const picker = document.getElementById("menuPicker");
      picker.innerHTML = "<option disabled selected>載入中...</option>";
      firebase.database().ref("menus").once("value", snapshot => {
        picker.innerHTML = "";
        snapshot.forEach(child => {
          const opt = document.createElement("option");
          opt.value = child.key;
          opt.textContent = child.key;
          picker.appendChild(opt);
        });
      });
    }

    function loadAndStartOrder() {
      const name = document.getElementById("menuPicker").value;
      loadMenu(name);
      switchMode("order");
    }
  </script>
</body>
</html>
